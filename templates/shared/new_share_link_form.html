<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Create Share Link | Oil ERP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Favicon + Brand -->
  <link rel="icon" href="https://res.cloudinary.com/dl2ipzxyk/image/upload/v1751107241/logo_ijmteg.avif" type="image/png">

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

  <style>
    body { background:#f6f8fb; }
    .navbar-brand img { height: 36px; }
    .page-wrap { max-width: 880px; margin-inline: auto; }
    .card { border: none; border-radius: 14px; box-shadow: 0 6px 20px rgba(0,0,0,.06); }
    .form-text { color:#64748b; }
    .hint { color:#475569; }
    .chip { background:#eef2ff; color:#3b82f6; border-radius:999px; padding:.25rem .6rem; font-size:.8rem; }
    .divider { height:1px; background:#e9ecef; margin: 1rem 0; }
  </style>
</head>
<body>

<!-- Top Bar -->
<nav class="navbar navbar-light bg-white shadow-sm">
  <div class="container-fluid page-wrap">
    <a class="navbar-brand d-flex align-items-center gap-2" href="#">
      <img src="https://res.cloudinary.com/dl2ipzxyk/image/upload/v1751107241/logo_ijmteg.avif" alt="Company Logo">
      <span class="fw-semibold d-none d-sm-inline">TrueType Services</span>
    </a>
    <span class="chip">Admin • Share Link</span>
  </div>
</nav>

<!-- Content -->
<main class="page-wrap py-4 px-3 px-sm-2">
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <div class="card">
        <div class="card-body p-4 p-sm-5">
          <div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mb-2">
            <h4 class="mb-0">Create BDC Share Link</h4>
            <small class="text-muted">Partner will only see deliveries for the chosen BDC</small>
          </div>

          {% if error %}
            <div class="alert alert-danger py-2 mb-3">{{ error }}</div>
          {% endif %}

          <form method="post" action="{{ url_for('shared_links.new_share_link_form') }}" autocomplete="off" novalidate>
            <!-- BDC -->
            <div class="mb-3">
              <label class="form-label fw-semibold">BDC</label>
              {% if bdc_names and bdc_names|length > 0 %}
                <select name="bdc_name" class="form-select" required>
                  <option value="">Select BDC…</option>
                  {% for n in bdc_names %}
                    <option value="{{ n }}">{{ n }}</option>
                  {% endfor %}
                </select>
              {% else %}
                <input type="text" name="bdc_name" class="form-control" placeholder="Enter BDC name" required>
              {% endif %}
              <div class="form-text">The shared page will be locked to this BDC only.</div>
            </div>

            <!-- Passcode -->
            <div class="mb-3">
              <label class="form-label fw-semibold">Passcode (5 digits)</label>
              <div class="input-group">
                <input
                  id="passcode"
                  type="password"
                  name="passcode"
                  class="form-control"
                  inputmode="numeric"
                  pattern="\d{5}"
                  maxlength="5"
                  minlength="5"
                  required
                  placeholder="*****"
                  aria-describedby="passHelp passCount">
                <button class="btn btn-outline-secondary" type="button" id="togglePass">
                  Show
                </button>
              </div>
              <div class="d-flex justify-content-between">
                <div id="passHelp" class="form-text">The partner must enter this to unlock the page.</div>
                <small id="passCount" class="form-text">0 / 5</small>
              </div>
            </div>

            <!-- Expiry -->
            <div class="mb-3">
              <label class="form-label fw-semibold">Expires In (days)</label>
              <input type="number" name="expires_in_days" class="form-control" value="7" min="1" max="90" required>
              <div class="form-text">After expiry, the link becomes invalid automatically.</div>
            </div>

            <div class="divider"></div>

            <div class="row g-3 align-items-center">
              <div class="col-12 col-sm">
                <div class="hint small">
                  <strong>Security:</strong> the passcode is stored as a secure hash; the URL is a random token; you can revoke the link at any time.
                </div>
              </div>
              <div class="col-12 col-sm-auto">
                <button type="submit" class="btn btn-primary w-100">
                  Generate Link
                </button>
              </div>
            </div>
          </form>

        </div>
      </div>

      <div class="text-center text-muted mt-3 small">
        © {{ (now() if now else None) or '' }} Oil ERP · Powered by CYTECH
      </div>
    </div>
  </div>
</main>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  // Passcode: numeric-only guard + counter + show/hide
  (function () {
    const input = document.getElementById('passcode');
    const count = document.getElementById('passCount');
    const toggle = document.getElementById('togglePass');

    function updateCount() {
      count.textContent = (input.value || '').length + ' / 5';
    }
    input.addEventListener('input', () => {
      // keep only digits, max 5
      input.value = (input.value.replace(/\D/g, '')).slice(0, 5);
      updateCount();
    });
    updateCount();

    toggle.addEventListener('click', () => {
      const t = input.getAttribute('type') === 'password' ? 'text' : 'password';
      input.setAttribute('type', t);
      toggle.textContent = (t === 'password') ? 'Show' : 'Hide';
    });
  })();
</script>
</body>
</html>
